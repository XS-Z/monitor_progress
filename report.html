<!--Script references. -->
<script src="/Scripts/jquery.2.2.3.min.js"></script>
<!--Reference the SignalR library. -->
<script src="/Scripts/jquery.signalR-2.1.0.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="/signalr/hubs"></script>
<style>
#progress_container{position:fixed;width:100vw;background-color:lightgray;left:0;bottom:0;display:none;}
#progress{height:5px;background-color:yellow;}
</style>
<div id="progress_container"><div id="progress_container"></div></div>
<script>
    (function () {
        // Reference the auto-generated proxy for the hub.
        var downloadProgressHub = $.connection.downloadProgressHub;
        // Create a function that the hub can call back to display messages.
        downloadProgressHub.client.updateProgress = function (progress) {
            //console.log(progress);
            if (progress === 100) {
                progress_container.style.display = "none";
            }
            progress_dom.innerText = progress + " %";
            progress_dom.style.width = progress + "vw";
        };
        // Start the connection.
        $.connection.hub.start();
        $(function () {
            progress_container = document.getElementById("progress_container");
            progress_dom = document.getElementById("progress");
        });
        var userName = document.getElementById("userName").value, // here just use userName as token, apparently its limitation is that it can monitor only 1 task at the same time. You can replace it with uuid or Date.now() to avoid the limitation.
            progress_container, progress_dom;
        window.monitorProgress = function () {
            progress_container.style.display = "block";
            downloadProgressHub.server.send(userName, "progress?");
        };
        // setTimeout(function(){monitorProgress();}, 2000);    //just for test
    })();
</script>
